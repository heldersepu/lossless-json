!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(r.LosslessJSON={})}(this,function(r){"use strict";function n(r){return r&&void 0!=r.circularRefs&&(g=!0===r.circularRefs),{circularRefs:g}}function e(r){if("string"==typeof r){if(!function(r){return/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?$/.test(r)}(r))throw new Error('Invalid number (value: "'+r+'")');return r}if("number"==typeof r){if(t(r+"").length>15)throw new Error("Invalid number: contains more than 15 digits (value: "+r+")");if(isNaN(r))throw new Error("Invalid number: NaN");if(!isFinite(r))throw new Error("Invalid number: Infinity");return r+""}return e(r&&r.valueOf())}function t(r){return("string"!=typeof r?r+"":r).replace(/^-/,"").replace(/e.*$/,"").replace(/^0\.?0*|\./,"")}function o(r,n,e,t){return Array.isArray(e)?t.call(r,n,function(r,n){for(var e=[],t=0;t<r.length;t++)e[t]=o(r,t+"",r[t],n);return e}(e,t)):e&&"object"===(void 0===e?"undefined":N(e))&&!e.isLosslessNumber?t.call(r,n,function(r,n){var e={};for(var t in r)r.hasOwnProperty(t)&&(e[t]=o(r,t,r[t],n));return e}(e,t)):t.call(r,n,e)}function i(r){return encodeURIComponent(r.replace(/\//g,"~1").replace(/~/g,"~0"))}function u(r){return decodeURIComponent(r).replace(/~1/g,"/").replace(/~0/g,"~")}function f(r){return"#/"+r.map(i).join("/")}function a(){U++,k=R.charAt(U)}function c(){for(j=E.NULL,C="";" "==k||"\t"==k||"\n"==k||"\r"==k;)a();if(L[k])return j=E.DELIMITER,C=k,void a();if(s(k)||"-"==k){if(j=E.NUMBER,"-"==k){if(C+=k,a(),!s(k))throw v("Invalid number, digit expected",U)}else"0"==k&&(C+=k,a());for(;s(k);)C+=k,a();if("."==k){if(C+=k,a(),!s(k))throw v("Invalid number, digit expected",U);for(;s(k);)C+=k,a()}if("e"==k||"E"==k){if(C+=k,a(),"+"!=k&&"-"!=k||(C+=k,a()),!s(k))throw v("Invalid number, digit expected",U);for(;s(k);)C+=k,a()}}else if('"'!=k){if(!l(k)){for(j=E.UNKNOWN;""!=k;)C+=k,a();throw v('Syntax error in part "'+C+'"')}for(j=E.SYMBOL;l(k);)C+=k,a()}else{for(j=E.STRING,a();""!=k&&'"'!=k;)if("\\"==k){a();var r=O[k];if(void 0!==r)C+=r,a();else{if("u"!=k)throw v('Invalid escape character "\\'+k+'"',U);a();for(var n="",e=0;e<4;e++){if(!function(r){return/^[0-9a-fA-F]/.test(r)}(k))throw v("Invalid unicode character");n+=k,a()}C+=String.fromCharCode(parseInt(n,16))}}else C+=k,a();if('"'!=k)throw v("End of string expected");a()}}function l(r){return/^[a-zA-Z_]/.test(r)}function s(r){return r>="0"&&r<="9"}function v(r,n){void 0===n&&(n=U-C.length);var e=new SyntaxError(r+" (char "+n+")");return e.char=n,e}function h(){if("{"==C){c();var r=void 0,e={};if("}"==C)return c(),e;var t=M.length;for(M[t]=e;;){if(j!=E.STRING)throw v("Object key expected");if(r=C,c(),":"!=C)throw v("Colon expected");if(c(),A[t]=r,e[r]=h(),","!=C)break;c()}if("}"!=C)throw v('Comma or end of object "}" expected');return c(),function(r){return"string"==typeof r.$ref&&1===Object.keys(r).length}(e)?function(r){if(!n().circularRefs)return r;for(var e=function(r){var n=r.split("/").map(u);if("#"!==n.shift())throw SyntaxError("Cannot parse JSON Pointer: no valid URI fragment");return""===n[n.length-1]&&n.pop(),n}(r.$ref),t=0;t<e.length;t++)if(e[t]!==A[t])throw new Error('Invalid circular reference "'+r.$ref+'"');return M[e.length]}(e):(M.length=t,A.length=t,e)}return function(){if("["==C){c();var r=[];if("]"==C)return c(),r;var n=M.length;for(M[n]=r;A[n]=r.length+"",r.push(h()),","==C;)c();if("]"!=C)throw v('Comma or end of array "]" expected');return c(),M.length=n,A.length=n,r}return function(){if(j==E.STRING){var r=C;return c(),r}return function(){if(j==E.NUMBER){var r=new x(C);return c(),r}return function(){if(j==E.SYMBOL){if("true"===C)return c(),!0;if("false"===C)return c(),!1;if("null"===C)return c(),null;throw v('Unknown symbol "'+C+'"')}return function(){throw v(""==C?"Unexpected end of json string":"Value expected")}()}()}()}()}()}function d(r,n,e){P=[],B=[];var t="function"==typeof n?n.call({"":r},"",r):r,o=void 0;return"number"==typeof e?e>10?o=m(" ",10):e>=1&&(o=m(" ",e)):"string"==typeof e&&""!==e&&(o=e),p(t,n,o,"")}function p(r,n,e,t){if(!0===r||!1===r||r instanceof Boolean)return r+"";if(null===r)return"null";if("number"==typeof r||r instanceof Number)return isNaN(r)||!isFinite(r)?"null":r+"";if(r&&r.isLosslessNumber)return r.value;if("string"==typeof r||r instanceof String){for(var o="",i=0;i<r.length;i++){var u=r[i];o+=_[u]||u}return'"'+o+'"'}return r instanceof Date?'"'+r.toISOString()+'"':Array.isArray(r)?function(r,n,e,t){var o=e?t+e:void 0,i=e?"[\n":"[";if(b(r))return w(r,n,e,t);var u=P.length;P[u]=r;for(var f=0;f<r.length;f++){var a=f+"",c="function"==typeof n?n.call(r,a,r[f]):r[f];e&&(i+=o),void 0!==c&&"function"!=typeof c?(B[u]=a,i+=p(c,n,e,o)):i+="null",f<r.length-1&&(i+=e?",\n":",")}return P.length=u,B.length=u,i+=e?"\n"+t+"]":"]"}(r,n,e,t):r&&"object"===(void 0===r?"undefined":N(r))?y(r,n,e,t):void 0}function y(r,n,e,t){var o=e?t+e:void 0,i=!0,u=e?"{\n":"{";if("function"==typeof r.toJSON)return d(r.toJSON(),n,e);if(b(r))return w(r,n,e,t);var f=P.length;P[f]=r;for(var a in r)if(r.hasOwnProperty(a)){var c="function"==typeof n?n.call(r,a,r[a]):r[a];(function(r,n,e){return void 0!==n&&"function"!=typeof n&&(!Array.isArray(e)||function(r,n){for(var e=0;e<r.length;e++)if(r[e]==n)return!0;return!1}(e,r))})(a,c,n)&&(i?i=!1:u+=e?",\n":",",u+=e?o+'"'+a+'": ':'"'+a+'":',B[f]=a,u+=p(c,n,e,o))}return P.length=f,B.length=f,u+=e?"\n"+t+"}":"}"}function b(r){return-1!==P.indexOf(r)}function w(r,e,t,o){if(!n().circularRefs)throw new Error('Circular reference at "'+f(B)+'"');var i=P.indexOf(r);return y({$ref:f(B.slice(0,i))},e,t,o)}function m(r,n){for(var e="";n-- >0;)e+=r;return e}var g=!0,N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},I=(function(){function r(r){this.value=r}function n(n){function e(o,i){try{var u=n[o](i),f=u.value;f instanceof r?Promise.resolve(f.value).then(function(r){e("next",r)},function(r){e("throw",r)}):t(u.done?"return":"normal",u.value)}catch(r){t("throw",r)}}function t(r,n){switch(r){case"return":o.resolve({value:n,done:!0});break;case"throw":o.reject(n);break;default:o.resolve({value:n,done:!1})}(o=o.next)?e(o.key,o.arg):i=null}var o,i;this._invoke=function(r,n){return new Promise(function(t,u){var f={key:r,arg:n,resolve:t,reject:u,next:null};i?i=i.next=f:(o=i=f,e(r,n))})},"function"!=typeof n.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(r){return this._invoke("next",r)},n.prototype.throw=function(r){return this._invoke("throw",r)},n.prototype.return=function(r){return this._invoke("return",r)}}(),function(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}),S=function(){function r(r,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}return function(n,e,t){return e&&r(n.prototype,e),t&&r(n,t),n}}(),x=function(){function r(n){I(this,r),this.value=e(n),this.type="LosslessNumber",this.isLosslessNumber=!0}return S(r,[{key:"valueOf",value:function(){var r=parseFloat(this.value),n=t(this.value);if(n.length>15)throw new Error("Cannot convert to number: number would be truncated (value: "+this.value+")");if(!isFinite(r))throw new Error("Cannot convert to number: number would overflow (value: "+this.value+")");if(Math.abs(r)<Number.MIN_VALUE&&!function(r){return/^0*$/.test(r)}(n))throw new Error("Cannot convert to number: number would underflow (value: "+this.value+")");return r}},{key:"toString",value:function(){return this.value}}]),r}(),E={NULL:0,DELIMITER:1,NUMBER:2,STRING:3,SYMBOL:4,UNKNOWN:5},L={"":!0,"{":!0,"}":!0,"[":!0,"]":!0,":":!0,",":!0},O={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},R="",U=0,k="",C="",j=E.NULL,A=[],M=[],_={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},B=[],P=[];r.config=n,r.parse=function(r,n){U=0,k=(R=r).charAt(0),C="",j=E.NULL,M=[],A=[],c();var e=h();if(""!=C)throw v("Unexpected characters");return n?function(r,n){return o({"":r},"",r,n)}(e,n):e},r.stringify=d,r.LosslessNumber=x,Object.defineProperty(r,"__esModule",{value:!0})});
//# sourceMappingURL=lossless-json.js.map
